if (self.CavalryLogger) { CavalryLogger.start_js(["JkIi5"]); }

__d("FacecastStreamingCommentHealthTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){b("GeneratedLoggerUtils").log("logger:FacecastStreamingCommentHealthLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("logger:FacecastStreamingCommentHealthLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:FacecastStreamingCommentHealthLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setAppID=function(a){this.$1.appid=a;return this};a.prototype.setAppversion=function(a){this.$1.appversion=a;return this};a.prototype.setClientUserID=function(a){this.$1.client_userid=a;return this};a.prototype.setCommentID=function(a){this.$1.comment_id=a;return this};a.prototype.setGqlsContext=function(a){this.$1.gqls_context=a;return this};a.prototype.setProtocol=function(a){this.$1.protocol=a;return this};a.prototype.setSessionID=function(a){this.$1.session_id=a;return this};a.prototype.setVC=function(a){this.$1.vc=a;return this};c={appid:!0,appversion:!0,client_userid:!0,comment_id:!0,gqls_context:!0,protocol:!0,session_id:!0,vc:!0};e.exports=a}),null);
__d("LiveVideoCurrentlyWatchingViewersQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(){__p&&__p();var a;a=babelHelpers.inherits(c,b("WebGraphQLQueryBase"));a&&a.prototype;c.__getDocID=function(){"use strict";return"1756845024340619"};c.getQueryID=function(){"use strict";return"276588582806153"};function c(){"use strict";a.apply(this,arguments)}return c}()}),null);
__d("LivingRoomAnnouncementQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(){__p&&__p();var a;a=babelHelpers.inherits(c,b("WebGraphQLQueryBase"));a&&a.prototype;c.__getDocID=function(){"use strict";return"2080884971983525"};c.getQueryID=function(){"use strict";return"169247300451678"};function c(){"use strict";a.apply(this,arguments)}return c}()}),null);
__d("UFILiveVideoAnnouncementQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(){__p&&__p();var a;a=babelHelpers.inherits(c,b("WebGraphQLQueryBase"));a&&a.prototype;c.__getDocID=function(){"use strict";return"1654091934668900"};c.getQueryID=function(){"use strict";return"208016373275054"};function c(){"use strict";a.apply(this,arguments)}return c}()}),null);
__d("LiveVideoCommentCreateWebGraphQLSubscription",["WebGraphQLSubscriptionHelper"],(function(a,b,c,d,e,f){"use strict";e.exports=b("WebGraphQLSubscriptionHelper").getExports({docID:"1612252092219047",queryID:"1872910236339291"})}),null);
__d("UFILiveVideoCommentSubscription",["BaseGraphQLSubscription","LiveVideoCommentCreateWebGraphQLSubscription","uuid"],(function(a,b,c,d,e,f){a=babelHelpers["extends"]({},b("BaseGraphQLSubscription"),{_getTopic:function(a){return"gqls/live_video_comment_create_subscribe/feedback_id_"+a},_getQueryID:function(){return b("LiveVideoCommentCreateWebGraphQLSubscription").getDocID()},_getQueryParameters:function(a){return{input:JSON.stringify({client_subscription_id:b("uuid")(),feedback_id:a})}},_getSubscriptionCallName:function(){return"live_video_comment_create_subscribe"}});e.exports=a}),null);
__d("LiveVideoCommentUpdateWebGraphQLSubscription",["WebGraphQLSubscriptionHelper"],(function(a,b,c,d,e,f){"use strict";e.exports=b("WebGraphQLSubscriptionHelper").getExports({docID:"1778718412199003",queryID:"2108818762672549"})}),null);
__d("UFILiveVideoCommentUpdateSubscription",["BaseGraphQLSubscription","LiveVideoCommentUpdateWebGraphQLSubscription","uuid"],(function(a,b,c,d,e,f){a=babelHelpers["extends"]({},b("BaseGraphQLSubscription"),{_getTopic:function(a){return"gqls/facecast_comment_update_subscribe/feedback_id_"+a},_getQueryID:function(){return b("LiveVideoCommentUpdateWebGraphQLSubscription").getDocID()},_getQueryParameters:function(a){return{input:JSON.stringify({client_subscription_id:b("uuid")(),feedback_id:a})}},_getSubscriptionCallName:function(){return"facecast_comment_update_subscribe"}});e.exports=a}),null);
__d("LivingRoomCommentCreateWebGraphQLSubscription",["WebGraphQLSubscriptionHelper"],(function(a,b,c,d,e,f){"use strict";e.exports=b("WebGraphQLSubscriptionHelper").getExports({docID:"2227468203960791",queryID:"480994315694633"})}),null);
__d("UFILivingRoomCommentSubscription",["BaseGraphQLSubscription","LivingRoomCommentCreateWebGraphQLSubscription","uuid"],(function(a,b,c,d,e,f){a=babelHelpers["extends"]({},b("BaseGraphQLSubscription"),{_getTopic:function(a){return"gqls/living_room_comment_create_subscribe/feedback_id_"+a},_getQueryID:function(){return b("LivingRoomCommentCreateWebGraphQLSubscription").getDocID()},_getQueryParameters:function(a){return{input:JSON.stringify({client_subscription_id:b("uuid")(),feedback_id:a})}},_getSubscriptionCallName:function(){return"living_room_comment_create_subscribe"}});e.exports=a}),null);
__d("VideoAnnouncementSurface",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({POST:"post",STORIES:"stories",ALL:"all"})}),null);
__d("XLiveStreamingCommentsAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videos/livecomments/",{eft_id:{type:"String",required:!0}})}),null);
__d("XLiveStreamingRankingExperimentAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videos/livecomments/exp/",{eft_id:{type:"String",required:!0}})}),null);
__d("UFILiveStreamingComments",["fbt","Arbiter","AsyncRequest","BanzaiODS","CurrentUser","EntityPresenceManager","EntityPresenceTypeEnum","FacecastStreamingCommentDelayTypedLogger","FacecastStreamingCommentHealthTypedLogger","FeedbackSourceType","LiveVideoCurrentlyWatchingVideoPresenceConfig","LiveVideoCurrentlyWatchingViewersQueryWebGraphQLQuery","LivingRoomAnnouncementQueryWebGraphQLQuery","LivingRoomLoggerAction","LivingRoomTypedLogger","StreamingReactionsTrayEvents","TimeSlice","UFICentralUpdates","UFIConfig","UFIConstants","UFIFeedbackTargets","UFILiveStreamingCommentsConfig","UFILiveVideoAnnouncementQueryWebGraphQLQuery","UFILiveVideoCommentSubscription","UFILiveVideoCommentUpdateSubscription","UFILivingRoomCommentSubscription","UFIStreamingStateType","UFISubscriptionUpdates","UFIToplevelStreamedCommentList","VideoAnnouncementSurface","VideoBroadcastStatus","XLiveStreamingCommentsAsyncController","XLiveStreamingRankingExperimentAsyncController","clearInterval","gkx","setInterval","uuid"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=new Map(),i=1e4,j=1e4,k=1e4,l=3e4,m=2e3;b("BanzaiODS").setEntitySample("feedback",1e-4);function n(a,c,d,e,f,g,h,l){__p&&__p();this.eftID=a;this.totalCommentCount=c;this.tailCommentFBID=d;this.queue=[];this.ufiPayloadBuffer=[];this.fireworksAnimating=!1;this.liveVideoAnnouncements=[];this.liveVideoCachedCurrentViewers=new Set();this.liveVideoCurrentViewerFetchCounter=0;this.localCommentBodies=new Set();this.mayShortCircuitRendering=!1;this.mayLogExposure=!0;this.isViewerTheOwner=g;this.isLiveAudio=h;this.hasDisplayedFirstViewerJoinEvent=!1;this.contextArgs=l;this.interval=b("setInterval")(function(){return this.renderNextPayload()}.bind(this),b("UFILiveStreamingCommentsConfig").liveCommentRenderDelayMS);b("UFIFeedbackTargets").getFeedbackTarget(this.eftID,function(a){this.$1(a,l)}.bind(this));if(this.contextArgs.shouldLogFacecastStreamingCommentDelay){var n=b("uuid")();this.healthLoggerInterval=b("setInterval")(function(){var a=new(b("FacecastStreamingCommentHealthTypedLogger"))().setCommentID(this.tailCommentFBID).setSessionID(n);this.subscription&&a.setGqlsContext(this.subscription.getContext().transformContext);a.log()}.bind(this),j)}e&&(this.$2(!0),this.liveVideoAnnouncementFetchInterval=b("setInterval")(function(){this.$2(!1)}.bind(this),k));l.showLivingRoomAnnouncements&&this.$3();if(f){if(!b("gkx")("AT5hL4ddeKh2EYcVaZo0PLd2qLLkzRfHeDMADXw3EHaIKcDb74UtuWMPVUrrkHIFlcLlEZCbudEtIXiL5Joo-BVS")&&this.contextArgs.fluentContentToken){var o=this.contextArgs.fluentContentToken;this.liveVideoCurrentViewerFetchInterval=b("setInterval")(function(){var a=b("LiveVideoCurrentlyWatchingViewersQueryWebGraphQLQuery").getURI({video_id:o});new(b("AsyncRequest"))().setURI(a).setHandler(function(a){this.$4(a.payload)}.bind(this)).send();this.liveVideoCurrentViewerFetchCounter+=1}.bind(this),m)}!h&&b("LiveVideoCurrentlyWatchingVideoPresenceConfig").videoPresenceGK&&(this.presenceToken=b("EntityPresenceManager").enter(b("EntityPresenceTypeEnum").LIVE_VIDEO,this.eftID))}b("UFICentralUpdates").subscribe("update-comments",function(a,b){b.comments&&b.comments.length&&b.comments.forEach(function(a){if(a.parentcommentid)return;a.__typename==="local"&&this.trackLocalComment(a)}.bind(this))}.bind(this));b("Arbiter").subscribe(b("StreamingReactionsTrayEvents").FireworksAnimating,function(a,c){this.fireworksAnimating=c,this.fireworksAnimating?(clearTimeout(this.timeoutID),this.timeoutID=setTimeout(b("TimeSlice").guard(function(){this.fireworksAnimating&&(this.fireworksAnimating=!1,b("BanzaiODS").bumpEntityKey("streaming_comments","comment_fetching_unpause_failure"))}.bind(this),"UFILiveStreaming fireWorksAnimatingTimeout",{propagationType:b("TimeSlice").PropagationType.EXECUTION}),i)):this.backFillComments()}.bind(this))}n.prototype.$1=function(a,c){__p&&__p();var d=Date.now();if(c.icebreakerAccessTokenForCommentSubscription){this.subscription=b("UFILiveVideoCommentSubscription").subscribeWithIcebreaker_EXPERIMENTAL(a.targetfbid,function(a){return this.$5(a,d)}.bind(this),c.icebreakerAccessTokenForCommentSubscription);return}if(c.isLivingRoom){this.subscription=b("UFILivingRoomCommentSubscription").subscribe(a.targetfbid,function(a){return this.$6(a,d)}.bind(this),{policy:c.livingRoomCommentSubscriptionConfig});return}this.subscription=b("UFILiveVideoCommentSubscription").subscribe(a.targetfbid,function(a){return this.$5(a,d)}.bind(this),{policy:this.contextArgs.facecastCommentsPolicy});((c=this.contextArgs)!=null?(c=c.liveVideoCommentUIConfig)!=null?c.enableReactionUpdates:c:c)&&(this.commentUpdateSubscription=b("UFILiveVideoCommentUpdateSubscription").subscribe(a.targetfbid,function(c){b("UFISubscriptionUpdates").handleFacecastCommentUpdate(a.targetfbid,c,Date.now()-d)}))};n.prototype.$5=function(a,c){b("UFISubscriptionUpdates").handleLiveStreamingComment(this.eftID,a.live_video_comment_create_subscribe,Date.now()-c,this.contextArgs.shouldLogFacecastStreamingCommentDelay||!1)};n.prototype.$6=function(a,c){var d=a.living_room_comment_create_subscribe.comment;d&&new(b("LivingRoomTypedLogger"))().setLivingRoomAction(b("LivingRoomLoggerAction").COMMENT_PAYLOAD_RECEIVED).setLivingRoomID(this.eftID).addToExtraData("body",d.body&&d.body.text).addToExtraData("author",d.author.id).addToExtraData("comment_id",d.legacy_fbid).log();b("UFISubscriptionUpdates").handleLiveStreamingComment(this.eftID,a.living_room_comment_create_subscribe,Date.now()-c,this.contextArgs.shouldLogFacecastStreamingCommentDelay||!1)};n.prototype.$7=function(a){var c=a.comments[0].attachment&&a.comments[0].attachment.type==="TIP_JAR_PAYMENT";a=b("UFIConfig").tipJarCommentsNotThrottled||a.comments[0].author===b("CurrentUser").getAccountID();return c&&a};n.prototype.enqueueSubscribedComment=function(a,b){this.contextArgs.facecastCommentsPolicy||this.contextArgs.isLivingRoom||this.$7(a)?this.$8(a):this.$9(a),this.$10(b)};n.prototype.enqueueSubscribedTipJarEvent=function(a,c){this.$9({comments:[this.$11(a,c)],streamingstate:b("UFIStreamingStateType").LIVE,priority:0})};n.prototype.$2=function(a){if(this.liveVideoAnnouncements.length||!this.contextArgs.fluentContentToken)return;a=this.contextArgs.source===b("FeedbackSourceType").LIVE_VIDEO_STORIES?b("VideoAnnouncementSurface").STORIES:b("VideoAnnouncementSurface").POST;a=b("UFILiveVideoAnnouncementQueryWebGraphQLQuery").getURI({video_id:this.contextArgs.fluentContentToken,surface:a});new(b("AsyncRequest"))().setURI(a).setHandler(function(a){this.$12(a.payload)}.bind(this)).send()};n.prototype.$3=function(){var a=b("LivingRoomAnnouncementQueryWebGraphQLQuery").getURI({living_room_id:this.eftID});new(b("AsyncRequest"))().setURI(a).setHandler(function(a){this.$13(a.payload)}.bind(this)).send()};n.prototype.$13=function(a){a=a.data.living_room;if(!a)return;a=a.living_room_announcements;if(!a.length)return;a=a[0];this.$9({comments:[{body:{text:a.message.text},ctaAction:a.cta_action,ctaGlyphName:a.cta_glyph,ctaTextOff:a.cta_text_off,ftentidentifier:this.eftID,id:this.eftID+"_"+a.name,isAnnouncement:!0,isLivingRoom:!0,isJoinEvent:!1,fbid:this.eftID}],streamingstate:b("UFIStreamingStateType").LIVE,priority:0})};n.prototype.$12=function(a){__p&&__p();var c;a=a.data.video;if(!a){b("clearInterval")(this.liveVideoAnnouncementFetchInterval);b("clearInterval")(this.liveVideoAnnouncementRenderInterval);return}a=a.announcements.edges;if(!a.length)return;(c=this.liveVideoAnnouncements).push.apply(c,a);this.liveVideoAnnouncementRenderInterval||(this.$14(),this.liveVideoAnnouncementRenderInterval=b("setInterval")(function(){this.$14()}.bind(this),l))};n.prototype.$14=function(){if(this.liveVideoAnnouncements.length){var a=this.liveVideoAnnouncements.pop();this.$9({comments:[this.$15(a)],streamingstate:b("UFIStreamingStateType").LIVE,priority:0})}};n.prototype.$4=function(a){__p&&__p();a=a.data.video;if(!a||a.broadcast_status!==b("VideoBroadcastStatus").LIVE){b("clearInterval")(this.liveVideoCurrentViewerFetchInterval);return}a=a.live_video_current_viewers.edges;if(!a.length)return;var c,d,e=[];for(var f=a,g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;var j=i.node.id;!this.liveVideoCachedCurrentViewers.has(j)&&i.node.name&&(c||(c=i.node.id,d=(i.node.profile_picture||{}).uri),e.push(i.node.name))}for(var j=a,i=Array.isArray(j),h=0,j=i?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(i){if(h>=j.length)break;g=j[h++]}else{h=j.next();if(h.done)break;g=h.value}f=g;a=f.node.id;this.liveVideoCachedCurrentViewers.add(a)}if(!c)return;g=this.$16(c,d,e);this.$9({comments:[g],streamingstate:b("UFIStreamingStateType").LIVE,priority:0})};n.prototype.handleWatchingStoreJoinEvents=function(a,c){var d,e,f=[];c.forEach(function(a){this.liveVideoCachedCurrentViewers.has(a.uniqueID)||(d||(d=a.uniqueID,e=a.profilePicURI),f.push(a.name),this.liveVideoCachedCurrentViewers.add(a.uniqueID))}.bind(this));if(!d)return;a=this.$16(d,e,f);this.$9({comments:[a],streamingstate:b("UFIStreamingStateType").LIVE,priority:0})};n.prototype.$16=function(a,b,c){var d=!1;!this.isViewerTheOwner&&!this.hasDisplayedFirstViewerJoinEvent&&(this.hasDisplayedFirstViewerJoinEvent=!0,d=!0);return{accentColor:null,ctaAction:"none",ctaGlyphName:null,ctaGlyphNameOff:null,ctaLink:null,ctaState:!1,ctaTextOff:"",ctaTextOn:"",ftentidentifier:this.eftID,glyphName:null,id:this.eftID+a+"_"+this.liveVideoCurrentViewerFetchCounter,image:b,isAnnouncement:!0,isJoinEvent:!0,joinEventData:{isFirstViewerJoinEvent:d,isLiveAudio:this.isLiveAudio,newlyJoinedViewerNames:c},targetID:null}};n.prototype.$11=function(a,b){b=b.tip_jar_tip_event_subscribe.tip_jar_transaction;return{author:b.tip_giver.id,body:{text:g._("sent {The amount of the gift money}!",[g._param("The amount of the gift money",b.currency_quantity_tipped.formatted)])},cancomment:!1,ftentidentifier:a.targetfbid,id:a.targetfbid+"_"+b.id,fbid:b.id,tipOptionIndex:b.tip_option_index.toString(),__typename:"saved"}};n.prototype.$15=function(a){a=a.node;return{accentColor:a.accent_color,body:{text:a.message},broadcastSubscriptionStatus:a.broadcast_subscription_status,ctaAction:a.cta_action,ctaGlyphName:a.cta_glyph,ctaGlyphNameOff:a.cta_glyph_off,ctaLink:a.cta_link,ctaState:a.cta_state,ctaTextOff:a.cta_text_off,ctaTextOn:a.cta_text_on,ftentidentifier:this.eftID,glyphName:a.glyph_name,id:this.eftID+a.name+a.level,image:a.image,isAnnouncement:!0,isJoinEvent:!1,targetID:a.target&&a.target.id}};n.prototype.$9=function(a){if(this.resemblesLocalComment(a.comments[0]))return;this.tailCommentFBID=a.comments[0].fbid;this.queue.push(a);this.queue=n.pruneQueue(this.queue);this.queue.length===1&&this.mayShortCircuitRendering&&(b("BanzaiODS").bumpEntityKey("streaming_comments","short_circuit_render"),b("clearInterval")(this.interval),this.renderNextPayload(),this.interval=b("setInterval")(function(){return this.renderNextPayload()}.bind(this),b("UFILiveStreamingCommentsConfig").liveCommentRenderDelayMS))};n.prototype.$8=function(a){if(this.resemblesLocalComment(a.comments[0]))return;this.tailCommentFBID=a.comments[0].fbid;this.renderPayload(a)};n.prototype.$10=function(a){a=a-this.queue.length;a>this.totalCommentCount&&(this.totalCommentCount=a,b("UFIToplevelStreamedCommentList").getCommentList(this.eftID).updateCommentCount(this.totalCommentCount))};n.prototype.$17=function(){var a=b("UFIToplevelStreamedCommentList").getCommentList(this.eftID);while(this.queue.length){var c=this.queue.shift();if(!a.hasComment(c.comments[0]))return c}return null};n.prototype.renderPayload=function(a){if(!a){this.mayShortCircuitRendering=!0;return}this.fireworksAnimating?this.ufiPayloadBuffer.push(a):(b("UFICentralUpdates").handleUpdate(b("UFIConstants").UFIPayloadSourceType.STREAMING,a),this.contextArgs.shouldLogFacecastStreamingCommentDelay&&new(b("FacecastStreamingCommentDelayTypedLogger"))().setCommentID(a.comments[0].fbid).setEvent("render").log(),this.contextArgs.isLivingRoom&&new(b("LivingRoomTypedLogger"))().setLivingRoomAction(b("LivingRoomLoggerAction").COMMENT_PAYLOAD_RENDERED).setLivingRoomID(this.eftID).addToExtraData("body",a.comments[0].body&&a.comments[0].body.text).addToExtraData("author",a.comments[0].author).addToExtraData("comment_id",a.comments[0].fbid).log(),b("BanzaiODS").bumpEntityKey("feedback","facecast_live_comment_rendered"));this.mayShortCircuitRendering=!1;b("CurrentUser").isLoggedIn()&&this.mayLogExposure&&(new(b("AsyncRequest"))().setURI(b("XLiveStreamingRankingExperimentAsyncController").getURIBuilder().setString("eft_id",this.eftID).getURI()).send(),this.mayLogExposure=!1)};n.prototype.renderNextPayload=function(){this.renderPayload(this.$17())};n.prototype.backFillComments=function(){__p&&__p();for(var a=this.ufiPayloadBuffer,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;b("UFICentralUpdates").handleUpdate(b("UFIConstants").UFIPayloadSourceType.STREAMING,e)}this.ufiPayloadBuffer=[]};n.prototype.getNextURI=function(){return b("XLiveStreamingCommentsAsyncController").getURIBuilder().setString("eft_id",this.eftID).getURI()};n.prototype.trackLocalComment=function(a){a=n.hashCommentData(a);this.localCommentBodies.add(a)};n.prototype.resemblesLocalComment=function(a){if(a.isAnnouncement)return!1;a=n.hashCommentData(a);return this.localCommentBodies.has(a)};n.prototype.stopStream=function(){b("clearInterval")(this.interval),b("clearInterval")(this.healthLoggerInterval),b("clearInterval")(this.liveVideoAnnouncementFetchInterval),b("clearInterval")(this.liveVideoAnnouncementRenderInterval),this.subscription&&this.subscription.unsubscribe(),this.commentUpdateSubscription&&this.commentUpdateSubscription.unsubscribe(),this.presenceToken&&this.presenceToken.leave(),h["delete"](this.eftID)};n.hashCommentData=function(a){var b=a.author;a.body&&(b+=":"+a.body.text);a.attachment&&(b+=":"+a.attachment.fbid);return b};n.pruneQueue=function(a){__p&&__p();var c=a.length-b("UFIConfig").facecastWWWCommentQueueThreshold;if(c<=0)return a;var d=a.map(function(a,b){return{index:b,priority:a.priority}}).sort(function(a,b){var c=a.priority-b.priority;return c!==0?c:a.index-b.index}).map(function(a){return a.index}).slice(0,c);return a.filter(function(a,b){return d.indexOf(b)===-1})};n.start=function(a,b,c,d,e,f,g,i){var j=h.get(a),k=!j||!j.liveVideoAnnouncementFetchInterval&&d||!j.liveVideoCurrentViewerFetchInterval&&e;if(!k)return;j&&j.stopStream();h.set(a,new n(a,b,c,d,e,f,g,i))};n.enqueueSubscribedComment=function(a,b,c){a=h.get(a);if(!a)return;a.enqueueSubscribedComment(b,c)};n.enqueueLiveJoinEventComment=function(a,b){var c=h.get(a);if(!c||!c.showLiveVideoBroadcastingJoinEvents)return;c.handleWatchingStoreJoinEvents(a,b)};n.enqueueSubscribedTipJarEvent=function(a,b){var c=h.get(a.targetfbid);if(!c)return;c.enqueueSubscribedTipJarEvent(a,b)};n.stop=function(a){a=h.get(a);if(!a)return;a.stopStream()};e.exports=n}),null);
__d("LiveVideoEndScreenTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){b("GeneratedLoggerUtils").log("logger:LiveVideoEndScreenLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("logger:LiveVideoEndScreenLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:LiveVideoEndScreenLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setEvent=function(a){this.$1.event=a;return this};a.prototype.setVC=function(a){this.$1.vc=a;return this};a.prototype.setVideoID=function(a){this.$1.video_id=a;return this};c={event:!0,vc:!0,video_id:!0};e.exports=a}),null);
__d("AsyncFormRequestUtils",["Arbiter"],(function(a,b,c,d,e,f){a={subscribe:function(a,c,d){b("Arbiter").subscribe("AsyncRequest/"+c,function(b,c){b=c.request.relativeTo;b&&b===a&&d(c)})}};e.exports=a}),null);
__d("XLiveViewerAsyncDismissNuxController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/live/viewer/nux/dismiss/",{video_id:{type:"String"},source:{type:"String"}})}),null);
__d("XLiveWatchingAsyncNuxController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/live/watching/",{video_id:{type:"String"},source:{type:"String"},unmuted:{type:"Bool",defaultValue:!0}})}),null);
__d("LiveVideoIndicatorOverlay",["csx","cx","invariant","AsyncRequest","CSS","DOM","Event","React","Run","SubscriptionsHandler","VideoPlayerLoggerSource","XLiveViewerAsyncDismissNuxController","XLiveWatchingAsyncNuxController"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();var j=!1;function k(a,c,d,e,f,g,h,k){"use strict";__p&&__p();this.$3=a;this.$1=c;this.$4=e;this.$5=a.getVideoID();this.$6=f;this.$7=!1;this.$2=new(b("SubscriptionsHandler"))();this.$2.addSubscriptions(a.addListener("streamInterrupted",this.$8.bind(this)),a.addListener("streamResumed",this.$9.bind(this)),a.addListener("finishPlayback",this.$10.bind(this)),a.addListener("beginPlayback",this.$11.bind(this)),a.addListener("VideoChannelController/enterChannel",this.$12.bind(this)),a.addListener("VideoChannelController/exitChannel",this.$13.bind(this)),a.addListener("TahoeController/enterTahoe",this.$14.bind(this)),a.addListener("TahoeController/exitTahoe",this.$15.bind(this)));if(this.$4!=null){this.$4!=null||i(0);d=b("DOM").scry(this.$4.getContentRoot(),"._36gl")[0];if(!d)return;var l=b("Event").listen(d,"click",function(){l&&(l.remove(),l=null),new(b("AsyncRequest"))().setAllowCrossPageTransition().setURI(b("XLiveViewerAsyncDismissNuxController").getURIBuilder().getURI()).setData({video_id:this.$5,source:this.$3.getSource()}).setHandler(function(){j=!0}).send()}.bind(this))}g==="tahoe"&&this.$14();b("Run").onLeave(function(){return this.$2.release()}.bind(this))}k.prototype.$16=function(){"use strict";var a=this.$3.getSource();return a==b("VideoPlayerLoggerSource").CHANNEL||a==b("VideoPlayerLoggerSource").SNOWLIFT||a==b("VideoPlayerLoggerSource").PERMALINK?!0:!1};k.prototype.$11=function(){"use strict";(this.$6||this.$16())&&setTimeout(function(){return this.$17()}.bind(this),k.DELAY_TO_SHOW_WATCHING_NUX*1e3),this.$18()};k.prototype.$14=function(){"use strict";this.$7=!0;this.$6=!0;this.$19();var a=this.$4;a&&(a.setOffsetX(65),a.setOffsetY(80))};k.prototype.$15=function(){"use strict";this.$7=!1,this.$6=!1,this.$20(),this.$18()};k.prototype.$12=function(){"use strict";this.$6=!0};k.prototype.$13=function(){"use strict";this.$6=!1,this.$20()};k.prototype.$17=function(){"use strict";this.$4&&!j&&this.$4.show(),new(b("AsyncRequest"))().setAllowCrossPageTransition().setURI(b("XLiveWatchingAsyncNuxController").getURIBuilder().getURI()).setData({video_id:this.$5,source:this.$3.getSource(),unmuted:!this.$3.isMuted()}).send()};k.prototype.$8=function(){"use strict";this.$19()};k.prototype.$9=function(){"use strict";this.$18()};k.prototype.$19=function(){"use strict";b("CSS").removeClass(this.$1,"_3rno")};k.prototype.$18=function(){"use strict";if(this.$3.isState("finished")||this.$7)return;b("CSS").addClass(this.$1,"_3rno")};k.prototype.$10=function(){"use strict";this.$19(),this.$20()};k.prototype.$20=function(){"use strict";this.$4&&this.$4.isShown()&&this.$4.hide()};k.DELAY_TO_SHOW_WATCHING_NUX=8;e.exports=k}),null);
__d("VideoBroadcastSubscriptionAction",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({SUBSCRIBE:"subscribe",SUBSCRIBE_SUGGESTED:"subscribe_suggested",UNSUBSCRIBE:"unsubscribe"})}),null);
__d("VideoRightButtonBase",["csx","cx","AsyncFormRequestUtils","CSS","DOM","Event","FormSubmit","LayerRefocusOnHide","Run","SubscriptionsHandler","throttle"],(function(a,b,c,d,e,f,g,h){__p&&__p();function a(a,c,d,e,f,g,h,i){"use strict";__p&&__p();this.$1=[];this.$2=c;this.$3=g;this.$4=f;this.$5=a;this.$6=h.hiddenAfterFinish;this.$7=h.hiddenWhilePaused;this.$8=h.allowHide;this.$9=new(b("SubscriptionsHandler"))();this.$10=!1;this.$11=!1;this.$12=!1;this.$13=i;this.$14=!1;if(this.$13){this.$13.disableBehavior(b("LayerRefocusOnHide"));d=b("DOM").scry(this.$13.getContentRoot(),"._36gl")[0];d&&b("Event").listen(d,"click",function(){this.$14=!1,this.$13=null,this.nuxViewClicked()}.bind(this));this.$13.subscribe("hide",function(){this.$14&&this.nuxViewHidden(),this.$14=!1,this.$13=null}.bind(this))}}a.prototype.setupAllHandlers=function(){"use strict";__p&&__p();this.$9=new(b("SubscriptionsHandler"))();var a=this.$5.getRootNode();b("Run").onLeave(function(){this.$9.release()}.bind(this));this.$9.addSubscriptions(b("Event").listen(a,"mousemove",b("throttle")(function(){return this.$15()}.bind(this),200)),b("Event").listen(a,"mouseenter",function(){if(this.$6&&this.$11||this.$7&&this.$12)return;this.$16=!0;this.$15();this.$13&&(this.$13.show(),this.$14=!0)}.bind(this)),b("Event").listen(a,"mouseleave",function(){this.$17(),this.$16=!1}.bind(this)),this.$5.addListener("beginPlayback",function(){this.$11=!1,this.$12=!1}.bind(this)),this.$5.addListener("finishPlayback",function(){this.$17(),this.$11=!0}.bind(this)),this.$5.addListener("pausePlayback",function(){this.$17(),this.$12=!0}.bind(this)));b("Event").listen(this.$2,"click",function(){this.$18&&clearTimeout(this.$18),this.$1.length===0&&(this.$3.setAttribute("value",this.nextActionOnToggle(this.$10)),b("FormSubmit").send(this.$4)),this.$10?(this.toggleSwitchOffAnimation(this.$2),this.$1.push(!1),this.$10=!1):(this.toggleSwitchOnAnimation(this.$2),this.$1.push(!0),this.$10=!0)}.bind(this));a=function(a){a=this.$3.getAttribute("value")===this.nextActionOnToggle(!0);if(this.$1.length>1){var c=this.$1[this.$1.length-1];c=c;(a&&!c||!a&&c)&&(this.$3.setAttribute("value",this.nextActionOnToggle(c)),b("FormSubmit").send(this.$4))}this.$1=[]}.bind(this);b("AsyncFormRequestUtils").subscribe(this.$4,"response",a)};a.prototype.$17=function(){"use strict";!this.$14&&this.$8&&b("CSS").addClass(this.$2,"_55c1")};a.prototype.$15=function(){"use strict";this.$16&&(b("CSS").removeClass(this.$2,"_55c1"),clearTimeout(this.$19),this.$19=setTimeout(function(){return this.$17()}.bind(this),3e3))};a.prototype.toggleSwitchOnAnimation=function(){"use strict";throw new Error("This should be overwritten by children")};a.prototype.toggleSwitchOffAnimation=function(){"use strict";throw new Error("This should be overwritten by children")};a.prototype.nextActionOnToggle=function(a){"use strict";throw new Error("This should be overwritten by children")};a.prototype.nuxViewClicked=function(){"use strict";throw new Error("This should be overwritten by children")};a.prototype.nuxViewHidden=function(){"use strict";throw new Error("This should be overwritten by children")};e.exports=a}),null);
__d("XLiveSubscribeAsyncNuxController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/live/subscribe/nux/",{action:{type:"String"},video_id:{type:"String"}})}),null);
__d("VideoLiveFollowButton",["cx","fbt","AsyncRequest","CSS","DOM","VideoBroadcastSubscriptionAction","VideoRightButtonBase","XLiveSubscribeAsyncNuxController"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i;c=babelHelpers.inherits(a,b("VideoRightButtonBase"));i=c&&c.prototype;function a(a,c,d,e,f,g,h,j,k,l){"use strict";i.constructor.call(this,a,c,d,f,g,h,j,l),this.$VideoLiveFollowButton1=d,this.$VideoLiveFollowButton2=f,this.$VideoLiveFollowButton3=e,this.$VideoLiveFollowButton4=h.getAttribute("value")===b("VideoBroadcastSubscriptionAction").UNSUBSCRIBE,this.$VideoLiveFollowButton4?this.setSwitchOnState(c):this.setSwitchOffState(c),this.$VideoLiveFollowButton5=a.getVideoID(),this.setupAllHandlers(),this.$VideoLiveFollowButton6=k}a.prototype.nuxViewClicked=function(){"use strict";this.sendNuxSeenRequest("dismiss")};a.prototype.sendNuxSeenRequest=function(a){"use strict";new(b("AsyncRequest"))().setURI(b("XLiveSubscribeAsyncNuxController").getURIBuilder().getURI()).setData({action:a,video_id:this.$VideoLiveFollowButton5}).send()};a.prototype.nuxViewHidden=function(){"use strict";this.sendNuxSeenRequest("hide")};a.prototype.setSwitchOffState=function(a){"use strict";var c=h._("Live Notifications");b("CSS").removeClass(a,"_-kc");b("CSS").show(this.$VideoLiveFollowButton3);b("CSS").removeClass(this.$VideoLiveFollowButton1,"_knu");b("DOM").setContent(this.$VideoLiveFollowButton2,c)};a.prototype.setSwitchOnState=function(a){"use strict";var c=h._("Live Notifications");b("CSS").addClass(a,"_-kc");b("CSS").hide(this.$VideoLiveFollowButton3);b("CSS").addClass(this.$VideoLiveFollowButton1,"_knu");b("DOM").setContent(this.$VideoLiveFollowButton2,c)};a.prototype.nextActionOnToggle=function(a){"use strict";if(a)return b("VideoBroadcastSubscriptionAction").UNSUBSCRIBE;else return b("VideoBroadcastSubscriptionAction").SUBSCRIBE};a.prototype.toggleSwitchOnAnimation=function(a){"use strict";this.setSwitchOnState(a)};a.prototype.toggleSwitchOffAnimation=function(a){"use strict";this.setSwitchOffState(a)};e.exports=a}),null);
__d("LiveVideoEndScreenCTAs.react",["cx","ProfileTile.react","React"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=130;h=babelHelpers.inherits(a,b("React").Component);h&&h.prototype;a.prototype.$1=function(){return b("React").createElement("div",{className:"_2219"},b("React").createElement("div",{className:"_221a"},b("React").createElement(b("ProfileTile.react"),{id:this.props.ownerID,imageProps:{className:"_2240"},size:i})),b("React").createElement("div",{className:"_2241"},this.props.ownerName))};a.prototype.render=function(){return!this.props.shouldShow?null:this.$1()};function a(){h.apply(this,arguments)}e.exports=a}),null);
__d("LiveVideoEndScreenConstants",[],(function(a,b,c,d,e,f){"use strict";a={ACTIONS:{SET_THUMBNAILS:"SET_THUMBNAILS"}};e.exports=a}),null);
__d("LiveVideoEndScreenDispatcher",["ExplicitRegistrationReactDispatcher"],(function(a,b,c,d,e,f){"use strict";var g;c=babelHelpers.inherits(a,b("ExplicitRegistrationReactDispatcher"));g=c&&c.prototype;function a(a){g.constructor.call(this,a),this.dispatch=this.dispatch.bind(this)}e.exports=new a({strict:!0})}),null);
__d("XLiveVideoTopBroadcastThumbnailController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/video_broadcast/top_broadcast_thumbnails/",{video_id:{type:"FBID"},thumbnail_count:{type:"Int",defaultValue:2}})}),null);
__d("LiveVideoEndScreenThumbnails.react",["AsyncRequest","DOMContainer.react","React","VideoPlayerLoggerSource","XLiveVideoTopBroadcastThumbnailController"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;c=babelHelpers.inherits(a,b("React").Component);g=c&&c.prototype;function a(a){g.constructor.call(this,a);a=b("XLiveVideoTopBroadcastThumbnailController").getURIBuilder().setFBID("video_id",this.props.videoController.getVideoID()).setInt("thumbnail_count",3).getURI();new(b("AsyncRequest"))(a).send()}a.prototype.$1=function(){__p&&__p();if(!this.props.thumbnails)return null;var a=[];for(var c=this.props.thumbnails,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{e=c.next();if(e.done)break;f=e.value}f=f;a.push(b("React").createElement(b("DOMContainer.react"),{key:f.href},f))}return a};a.prototype.render=function(){return this.props.videoController.getIsInChannel()||this.props.videoController.getSource()===b("VideoPlayerLoggerSource").WATCH_SCROLL?null:b("React").createElement("div",null,this.$1())};e.exports=a}),null);
__d("LiveVideoEndScreenUIStore",["FluxMapStore","LiveVideoEndScreenConstants","LiveVideoEndScreenDispatcher","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=b("LiveVideoEndScreenConstants").ACTIONS;g=babelHelpers.inherits(a,b("FluxMapStore"));g&&g.prototype;a.prototype.getInitialState=function(){return b("immutable").Map({thumbnails:null})};a.prototype.reduce=function(a,b){switch(b.type){case h.SET_THUMBNAILS:a=a.set("thumbnails",b.value);break;default:break}return a};function a(){g.apply(this,arguments)}a.__moduleID=e.id;e.exports=new a(b("LiveVideoEndScreenDispatcher"))}),null);
__d("LiveVideoEndScreenThumbnailsContainer.react",["FluxContainer","LiveVideoEndScreenDispatcher","LiveVideoEndScreenThumbnails.react","LiveVideoEndScreenUIStore","React"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;c=babelHelpers.inherits(a,b("React").Component);g=c&&c.prototype;a.getStores=function(){return[b("LiveVideoEndScreenUIStore")]};a.calculateState=function(a,c){a=b("LiveVideoEndScreenUIStore").getState().toObject();c=a.thumbnails;return{thumbnails:c}};function a(a){g.constructor.call(this,a),b("LiveVideoEndScreenDispatcher").explicitlyRegisterStores([b("LiveVideoEndScreenUIStore")])}a.prototype.render=function(){return b("React").createElement(b("LiveVideoEndScreenThumbnails.react"),{thumbnails:this.state.thumbnails,videoController:this.props.videoController})};e.exports=b("FluxContainer").create(a,{withProps:!0})}),null);
__d("LiveVideoEndScreenEvent",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({SCREEN_SHOWN:"screen_shown"})}),null);
__d("VideoLiveEndscreen",["CSS","LiveMapEntryPointsLoggerController","LiveVideoEndScreenCTAs.react","LiveVideoEndScreenEvent","LiveVideoEndScreenThumbnailsContainer.react","LiveVideoEndScreenTypedLogger","React","ReactDOM","SubscriptionsHandler"],(function(a,b,c,d,e,f){__p&&__p();function a(a,c,d,e,f,g,h){"use strict";this.$3=a,this.$1=c,this.$4=d,this.$5=e,this.$6=f,this.$7=g,this.$8=h,this.$2=new(b("SubscriptionsHandler"))(),this.$2.addSubscriptions(a.addListener("beginPlayback",this.$9.bind(this)),a.addListener("finishPlayback",this.$10.bind(this)),a.addListener("playRequested",this.$11.bind(this)),a.addListener("VideoChannelController/exitChannel",this.$12.bind(this))),a.registerOption("VideoLiveEndscreen","enabled",function(){return!0})}a.prototype.$9=function(){"use strict";b("CSS").hide(this.$1)};a.prototype.$10=function(){"use strict";this.$4&&b("LiveMapEntryPointsLoggerController").logEndscreenImpression(),new(b("LiveVideoEndScreenTypedLogger"))().setEvent(b("LiveVideoEndScreenEvent").SCREEN_SHOWN).setVideoID(this.$3.getVideoID()).log(),b("CSS").show(this.$1),this.$5&&b("ReactDOM").render(b("React").createElement(b("LiveVideoEndScreenThumbnailsContainer.react"),{videoController:this.$3}),this.$5),this.$8&&b("ReactDOM").render(b("React").createElement(b("LiveVideoEndScreenCTAs.react"),{ownerID:this.$6,ownerName:this.$7,shouldShow:this.$3.getIsInChannel()}),this.$8)};a.prototype.$11=function(){"use strict";b("CSS").hide(this.$1)};a.prototype.$12=function(){"use strict";this.$8&&b("ReactDOM").unmountComponentAtNode(this.$8)};e.exports=a}),null);
__d("VideoLiveInterruptedScreen",["CSS","SubscriptionsHandler","VideoPlayerHTML5Experiments","clearTimeout","setTimeout"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("VideoPlayerHTML5Experiments").displayInterruptedScreenDelay;function a(a,c){this.$4=null,this.$3=a,this.$1=c,this.$2=new(b("SubscriptionsHandler"))(),this.$2.addSubscriptions(a.addListener("streamInterrupted",this.$5.bind(this)),a.addListener("streamResumed",this.$6.bind(this)))}a.prototype.$5=function(){g?(b("clearTimeout")(this.$4),this.$4=b("setTimeout")(function(){b("CSS").show(this.$1)}.bind(this),g)):b("CSS").show(this.$1)};a.prototype.$6=function(){g&&b("clearTimeout")(this.$4),b("CSS").hide(this.$1)};e.exports=a}),null);